# 重新安装

```sh
docker run -d --name my_redis -p 6379:6379 redis --requirepass "root"
docker run -p 3306:3306 --name my_mysql -e MYSQL_ROOT_PASSWORD=root -d mysql
docker run -d --hostname rabbit-host --name my_rabbitmq -e RABBITMQ_DEFAULT_USER=root -e RABBITMQ_DEFAULT_PASS=root -p 15672:15672 -p 5672:5672 rabbitmq:3-management
docker run --name my_postgres -d -p 5432:5432 -e POSTGRES_PASSWORD=root postgres:12.3
```

# 从头安装

```sh

yum list | grep java-1.8.0-openjdk

yum -y install java-1.8.0-openjdk*

java -version

docker pull redis:latest

docker run -d --name dr_redis_drs -p 6379:6379 redis --requirepass "admin"

docker pull mysql:latest

docker run -p 3306:3306 --name dr_mysql -e MYSQL_ROOT_PASSWORD=admin -d mysql

docker run -d --name dr_mysql -p 7002:3306 -e MYSQL_ROOT_PASSWORD=dr_mysql_admin_2023 mysql --lower_case_table_names=1

docker pull rabbitmq:3-management

docker run -d --hostname rabbit-host --name dr_rabbitmq -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin -p 15672:15672 -p 5672:5672 rabbitmq:3-management

docker pull postgres

docker run --name mypostgres -d -p 5432:5432 -e POSTGRES_PASSWORD=root postgres:12.3
```
# mongo副本集 安装

## docker-compose 安装

```sh
sudo curl -L "https://github.com/docker/compose/releases/download/1.28.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose

mkdir docker
cd docker\
mkdir mongodb
cd mongodb\
```

## mongo数据库开启副本集，以支持事务

```yaml  
# docker-compose.yaml

# mongod --replSet <复制集名称>

version: '2.3'
services:
  master:
    image: mongo:5.0.13
    container_name: dr_mongo
    restart: always
    privileged: true
    ports:
    - "27017:27017"
    volumes:
    - ./data/master:/data/db
    command: mongod --dbpath /data/db --replSet rs
```

1. 启动数据库

```bash
docker-compose up -d
```

note: 以下命令仅在初次创建数据库时执行一次即可

重启
```sh
docker-compose restart master
```

2. 数据库启动后执行命令进入bash

```bash
docker-compose exec master bash
```

3. 进入mongo控制台 , 开启权限

```bash
mongod --auth 
mongo
```

4. 初始化复制集

```bash
rs.initiate()
```

看到输出 ok: 1 则成功

```
{
	"info2" : "no configuration specified. Using a default configuration for the set",
	"me" : "02170b52b8f4:27017",
	"ok" : 1
}
```

5. 创建用户

```js
use admin

db.createUser( {user: "admin",pwd: "admin",roles: [ { role: "userAnyDatabase", db: "admin" } ]})
```

```js
 db.createUser({user:"root",pwd:"root",roles:[{role:"root",db:"admin"}]})
```


6. 重新安装并恢复 (终于会弄了)
   
```sh
docker-compose up -d

docker-compose exec master bash

mongo

rs.reconfig({_id: "rs",version: 1,members: [{ _id: 0, host : "localhost:27017" }]},{force:true})
```